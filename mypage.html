<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€ - GALLA</title>
    <link rel="stylesheet" href="css/mypage.css">
</head>

<body data-page="mypage">

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="assets/logo.png" class="logo" onclick="location.href='index.html'">
            <div class="setting-text" onclick="location.href='settings.html'">ì„¤ì •</div>
        </div>
    </header>

    <!-- PROFILE -->
    <section class="profile-section">

        <img src="assets/logo.png" class="profile-img" id="profileImg">

        <div class="profile-name" id="profileName">ìµëª…ì˜ ì‚¬ìš©ì</div>

        <div class="level-row">
            <span class="badge" onclick="location.href='quest.html'" id="badgeText">ğŸ”¥ ë§¤ìš´ í† ë¡ ëŸ¬</span>
            <span class="level" onclick="location.href='grade.html'" id="levelText">Lv. 1</span>
        </div>

        <div class="profile-desc" id="profileDesc">ì†Œê°œ ë¬¸êµ¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

        <div class="stats-row">
            <div class="stat-unit">
                <div class="stat-num" id="statDrop">0</div>
                <div class="stat-label">My Drop</div>
            </div>
            <div class="stat-unit">
                <div class="stat-num" id="statFollowers">0</div>
                <div class="stat-label">íŒ”ë¡œì›Œ</div>
            </div>
            <div class="stat-unit">
                <div class="stat-num" id="statSupports">0</div>
                <div class="stat-label">ì§€ì§€</div>
            </div>
            <div class="stat-unit">
                <div class="stat-num" id="statOppose">0</div>
                <div class="stat-label">ë°˜ë°œ</div>
            </div>
        </div>
    </section>

    <!-- TABS -->
    <section class="tabs">
        <div class="tab active" data-tab="my">My ê°ˆë¼</div>
        <div class="tab" data-tab="battle">Battle ê°ˆë¼</div>
        <div class="tab" data-tab="save">Save ê°ˆë¼</div>
        <div class="tab" data-tab="favorite">ì¦ê²¨ì°¾ê¸°</div>
    </section>

    <!-- CONTENT -->
    <section id="tabContent" class="content-area"></section>

</div>

<!-- NAVIGATION -->
<nav class="bottom-nav">

    <button class="nav-item" onclick="location.href='index.html'" data-page="home">
        <img src="assets/icons/nav-home.svg" class="nav-icon">
        <div class="nav-indicator"></div>
    </button>

    <button class="nav-item" onclick="location.href='search.html'" data-page="search">
        <img src="assets/icons/nav-search.svg" class="nav-icon">
        <div class="nav-indicator"></div>
    </button>

    <button class="nav-item" onclick="location.href='write.html'" data-page="write">
        <img src="assets/icons/nav-write.svg" class="nav-icon">
        <div class="nav-indicator"></div>
    </button>

    <button class="nav-item" onclick="location.href='plaza.html'" data-page="random">
        <img src="assets/icons/nav-plaza.svg" class="nav-icon">
        <div class="nav-indicator"></div>
    </button>

    <button class="nav-item active" onclick="location.href='mypage.html'" data-page="mypage">
        <img src="assets/icons/nav-user.svg" class="nav-icon">
        <div class="nav-indicator"></div>
    </button>
</nav>

<!-- Supabase -->
<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>

<!-- My Page ê¸°ëŠ¥ -->
<script src="js/mypage.js"></script>

<script>
/* ----------------------------------------------------------
    ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ ë° ìœ ì € ì •ë³´ ë¡œë”©
---------------------------------------------------------- */
document.addEventListener("DOMContentLoaded", async () => {
    const { data } = await supabase.auth.getSession();
    const session = data?.session;

    if (!session?.user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        location.href = "login.html";
        return;
    }

    const userId = session.user.id;

    const { data: profile } = await supabase
        .from("user_profiles")
        .select("*")
        .eq("user_id", userId)
        .single();

    if (profile) {
        document.getElementById("profileName").textContent = profile.nickname || "ìµëª…ì˜ ì‚¬ìš©ì";
        document.getElementById("profileDesc").textContent = profile.bio || "ì†Œê°œ ë¬¸êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.";

        document.getElementById("badgeText").textContent = profile.badge || "ğŸ”¥ ë§¤ìš´ í† ë¡ ëŸ¬";
        document.getElementById("levelText").textContent = "Lv. " + (profile.level || 1);

        document.getElementById("statDrop").textContent = profile.gp || 0;
        document.getElementById("statFollowers").textContent = profile.followers || 0;
        document.getElementById("statSupports").textContent = profile.supports || 0;
        document.getElementById("statOppose").textContent = profile.opposes || 0;
    }
});
</script>

</body>
</html>