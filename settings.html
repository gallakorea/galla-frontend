<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>설정 - GALLA</title>
    <link rel="stylesheet" href="./css/settings.css">
</head>

<body>

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="./assets/logo.png" class="logo" onclick="location.href='index.html'">
            <div class="header-title">설정</div>
            <div class="header-spacer"></div>
        </div>
    </header>


    <!-- SECTION: 계정 정보 -->
    <section class="section">
        <div class="section-title">계정 정보</div>

        <div class="card profile-card" onclick="location.href='profile.html'">
            <img src="./assets/logo.png" class="profile-img">
            <div class="profile-info">
                <div class="profile-name" id="profileName">익명의 사용자</div>
                <div class="profile-desc" id="profileBio">소개 문구가 여기에 표시됩니다.</div>
            </div>
            <div class="arrow">&gt;</div>
        </div>

        <div class="card list-card">
            <div class="list-item">
                <span>이메일</span>
                <span class="value" id="emailValue">-</span>
            </div>
            <div class="list-item">
                <span>전화번호</span>
                <span class="value" id="phoneValue">-</span>
            </div>
        </div>
    </section>


    <!-- SECTION: 지갑 / 정산 -->
    <section class="section">
        <div class="section-title">지갑 / 정산</div>

        <div class="card wallet-card">
            <div class="wallet-row">
                <span>총 후원 수익</span>
                <span class="num" id="revenueTotal">₩ 0</span>
            </div>
            <div class="wallet-row">
                <span>출금 가능 금액</span>
                <span class="num" id="revenueAvailable">₩ 0</span>
            </div>

            <button class="primary-btn" onclick="location.href='withdraw.html'">출금 요청</button>
        </div>

        <div class="card single-link" data-target="settlement.html">
            정산 내역 <span class="arrow">&gt;</span>
        </div>
    </section>


    <!-- SECTION: 기부 현황 -->
    <section class="section">
        <div class="section-title">기부 현황</div>

        <div class="card wallet-card">
            <div class="wallet-row">
                <span>내가 후원한 금액</span>
                <span class="num" id="donationTotal">₩ 0</span>
            </div>

            <button class="primary-btn" onclick="location.href='donation.html'">기부 사용처 보기</button>
        </div>
    </section>


    <!-- SECTION: 활동 통계 -->
    <section class="section">
        <div class="section-title">나의 활동 통계</div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-num" id="statMy">0</div>
                <div class="stat-label">🔥 만든 갈라</div>
            </div>
            <div class="stat-box">
                <div class="stat-num" id="statPro">0</div>
                <div class="stat-label">👍 찬성 수</div>
            </div>
            <div class="stat-box">
                <div class="stat-num" id="statCon">0</div>
                <div class="stat-label">👎 반대 수</div>
            </div>
            <div class="stat-box">
                <div class="stat-num" id="statComments">0</div>
                <div class="stat-label">💬 댓글 수</div>
            </div>
        </div>

        <div class="card report-card enhanced-galla-type" data-target="galla-type.html">
            <div class="report-title">나의 갈라치기 성향</div>
            <div class="galla-type-badge">🔥 논리적 개척자형</div>

            <div class="ratio-box">
                <div class="ratio-item">
                    <div class="ratio-label">찬성</div>
                    <div class="ratio-value pro">62%</div>
                </div>
                <div class="ratio-item">
                    <div class="ratio-label">반대</div>
                    <div class="ratio-value con">38%</div>
                </div>
            </div>

            <div class="categories">
                선호 주제: 연애·결혼 / 직장·경력 / 생활·일상
            </div>

            <div class="type-desc">
                새로운 이슈에 도전하며, 감정보다 논리를 우선하는 스타일입니다.
            </div>

            <div class="galla-tags">
                <span>#논리적</span>
                <span>#새로운이슈성향</span>
                <span>#고집은약간</span>
                <span>#직설화법</span>
            </div>

            <div class="arrow more">&gt;</div>
        </div>

    </section>


    <!-- SECTION: 등급 -->
    <section class="section">
        <div class="section-title">등급 · 성장</div>

        <div class="card single-link" data-target="grade.html">
            내 등급 보기 <span class="arrow">&gt;</span>
        </div>
    </section>

    <!-- SECTION: 데일리 미션 -->
    <section class="section">
        <div class="section-title">데일리 미션</div>

        <div class="card single-link" data-target="quest.html">
            오늘의 미션 보기 <span class="arrow">&gt;</span>
        </div>
    </section>


    <!-- SECTION: 보안 -->
    <section class="section">
        <div class="section-title">보안</div>

        <div class="card list-card">
            <div class="list-item" data-target="change-password.html">비밀번호 변경 <span class="arrow">&gt;</span></div>
            <div class="list-item" data-target="login-history.html">로그인 기록 <span class="arrow">&gt;</span></div>
            <div class="list-item logout" id="logoutBtn">로그아웃</div>
        </div>
    </section>


    <!-- SECTION: 고객센터 -->
    <section class="section">
        <div class="section-title">앱 정보 / 고객센터</div>

        <div class="card list-card">
            <div class="list-item" data-target="support.html">문의하기 <span class="arrow">&gt;</span></div>
            <div class="list-item">버전 정보 <span class="value">v1.0.0</span></div>
            <div class="list-item" data-target="terms.html">서비스 이용약관 <span class="arrow">&gt;</span></div>
            <div class="list-item" data-target="privacy.html">개인정보 처리방침 <span class="arrow">&gt;</span></div>
        </div>
    </section>


    <!-- BOTTOM NAVIGATION -->
    <nav class="nav">
        <div class="nav-inner">
            <img src="assets/icons/nav-home.svg" class="nav-icon nav-item" data-target="index.html">
            <img src="assets/icons/nav-search.svg" class="nav-icon nav-item" data-target="search.html">
            <img src="assets/icons/nav-write.svg" class="nav-icon nav-item" data-target="write.html">
            <img src="assets/icons/nav-random.svg" class="nav-icon nav-item" data-target="random.html">
            <img src="assets/icons/nav-user.svg" class="nav-icon nav-item active" data-target="mypage.html">
        </div>
    </nav>

</div>

<!-- COMMON: 페이지 이동 -->
<script>
document.querySelectorAll("[data-target]").forEach(el => {
    el.style.cursor = "pointer";
    el.addEventListener("click", () => {
        const to = el.dataset.target;
        if (to) location.href = to;
    });
});
</script>


<!-- Supabase 로딩 대기 -->
<script>
function waitForSupabaseClient() {
    return new Promise(resolve => {
        const timer = setInterval(() => {
            if (window.supabaseClient) {
                clearInterval(timer);
                resolve(window.supabaseClient);
            }
        }, 20);
    });
}
</script>

<!-- 로그인 체크 & 프로필 불러오기 & 로그아웃 -->
<script>
(async () => {
    const supabase = await waitForSupabaseClient();
    const { data } = await supabase.auth.getSession();

    if (!data.session?.user) {
        alert("로그인이 필요한 페이지입니다.");
        return location.href = "login.html";
    }

    const user = data.session.user;

    // 프로필 불러오기
    const { data: profile } = await supabase
        .from("user_profiles")
        .select("*")
        .eq("user_id", user.id)
        .single();

    if (profile) {
        document.getElementById("profileName").textContent = profile.nickname || "익명의 사용자";
        document.getElementById("profileBio").textContent = profile.bio || "소개 문구가 없습니다.";
        document.getElementById("emailValue").textContent = user.email;
        document.getElementById("phoneValue").textContent = profile.phone || "-";
    }

    // 로그아웃
    document.getElementById("logoutBtn").addEventListener("click", () => {
        window.gallaLogout();
    });
})();
</script>

<!-- Supabase SDK (단 1회) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<!-- Supabase Client 생성 -->
<script src="js/supabase.js"></script>

<!-- Settings 페이지 로직 -->
<script src="js/settings.js"></script>

</body>
</html>