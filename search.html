<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GALLA - ê²€ìƒ‰</title>

  <link rel="stylesheet" href="./css/search.css" />
</head>

<body data-page="search">
<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="assets/logo.png" alt="GALLA" class="logo" onclick="location.href='index.html'"/>

            <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… (ë¡œê·¸ì•„ì›ƒ ìƒíƒœ) -->
            <div class="auth-buttons" id="authBefore">
                <button onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
                <button onclick="location.href='signup.html'">íšŒì›ê°€ì…</button>
            </div>

            <!-- ë§ˆì´í˜ì´ì§€ (ë¡œê·¸ì¸ ìƒíƒœ) -->
            <div class="auth-buttons" id="authAfter" style="display:none;">
                <button onclick="location.href='mypage.html'">ë§ˆì´í˜ì´ì§€</button>
            </div>
        </div>
    </header>

    <main class="page-main search-page">

      <!-- ğŸ”€ Search Tabs -->
      <section class="search-tabs">

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs-header">
          <button class="tab-btn active" data-tab="hot">ğŸ”¥ í•«íŠ¸ë Œë“œ</button>
          <button class="tab-btn" data-tab="search">ğŸ” ê²€ìƒ‰</button>
          <button class="tab-btn" data-tab="ai">ğŸ”® ìœ í–‰ì˜ˆê°</button>
          <button class="tab-btn" data-tab="news">ğŸ“° ì‹¤ì‹œê°„ íƒ‘ ë‰´ìŠ¤</button>
        </div>

        <!-- íƒ­ ì½˜í…ì¸  -->
        <div class="tabs-body">

          <!-- ğŸ”¥ í•«íŠ¸ë Œë“œ -->
          <div class="tab-panel active" id="tab-hot">
            <h2 class="section-title">ì˜¤ëŠ˜ì˜ í•« íŠ¸ë Œë“œ</h2>
            <p class="section-sub">ì§€ê¸ˆ ê°€ì¥ ë§ì´ ê²€ìƒ‰ë˜ëŠ” í‚¤ì›Œë“œ TOP10</p>
            <div id="hot-trend-chips" class="hot-trend-chips"></div>

            <div class="tab-result">
              <p class="section-sub" id="hot-result-label"></p>
              <div id="hot-results" class="search-results-grid"></div>
            </div>
          </div>

          <!-- ğŸ” ê²€ìƒ‰ -->
          <div class="tab-panel" id="tab-search">
            <h2 class="section-title">ê°ˆë¼ì¹˜ê¸° ê²€ìƒ‰</h2>
            <p class="section-sub">ì œëª©, ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ê²€ìƒ‰</p>

            <form id="search-form" class="search-form">
              <div class="search-input-wrap">
                <input id="search-input" class="search-input" placeholder="ì˜ˆ: ì•¼ê·¼ ìˆ˜ë‹¹, ì—°ì• , 19ê¸ˆâ€¦" />
                <button class="search-submit-btn" type="submit">ê²€ìƒ‰</button>
              </div>
            </form>

            <div class="tab-result">
              <p class="section-sub" id="search-result-label"></p>
              <div id="search-results" class="search-results-grid"></div>
            </div>
          </div>

          <!-- ğŸ”® AI ìœ í–‰ì˜ˆê° -->
          <div class="tab-panel" id="tab-ai">
            <h2 class="section-title ai-title">AI ìœ í–‰ì˜ˆê°</h2>
            <p class="section-sub">AIê°€ ë¶„ì„í•œ ê¸‰ìƒìŠ¹ ì˜ˆê° ì´ìŠˆ</p>
            <div id="ai-trend-list" class="ai-trend-list"></div>
          </div>

          <!-- ğŸ“° ì‹¤ì‹œê°„ íƒ‘ ë‰´ìŠ¤ -->
          <div class="tab-panel" id="tab-news">
            <h2 class="section-title">ì‹¤ì‹œê°„ íƒ‘ ë‰´ìŠ¤</h2>
            <p class="section-sub">ì§€ê¸ˆ ê°€ì¥ ì£¼ëª©ë°›ëŠ” ì´ìŠˆ</p>
            <div id="top-news-list" class="news-list"></div>
          </div>

        </div>
      </section>

    </main>

    <!-- â­ ê³ ì • ë„¤ë¹„ê²Œì´í„° -->
    <nav class="bottom-nav fixed-nav">

        <button class="nav-item" data-target="index.html">
            <img src="./assets/icons/nav-home.svg" />
        </button>

        <button class="nav-item active" data-target="search.html">
            <img src="./assets/icons/nav-search.svg" />
        </button>

        <button class="nav-item" data-target="write.html">
            <img src="./assets/icons/nav-write.svg" />
        </button>

        <button class="nav-item" data-target="random.html">
            <img src="./assets/icons/nav-random.svg" />
        </button>

        <button class="nav-item" data-target="mypage.html">
            <img src="./assets/icons/nav-user.svg" />
        </button>

    </nav>

</div>

<!-- â­ Supabase (UMD ONLY) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>


<!-- â­ Supabase ë¡œë”© ëŒ€ê¸° -->
<script>
function waitForSupabaseClient() {
    return new Promise(resolve => {
        const timer = setInterval(() => {
            if (window.supabaseClient) {
                clearInterval(timer);
                resolve(window.supabaseClient);
            }
        }, 20);
    });
}
</script>


<!-- â­ ë¡œê·¸ì¸ UI ìë™ ì „í™˜ -->
<script>
(async () => {
    const supabase = await waitForSupabaseClient();
    const { data } = await supabase.auth.getSession();

    const loggedIn = !!data.session?.user;

    document.getElementById("authBefore").style.display = loggedIn ? "none" : "flex";
    document.getElementById("authAfter").style.display  = loggedIn ? "flex" : "none";
})();
</script>


<!-- â­ ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ ì‹œ ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬ -->
<script>
document.querySelectorAll(".nav-item").forEach(btn => {
    btn.addEventListener("click", async () => {

        const target = btn.dataset.target;
        if (!target) return;

        const supabase = await waitForSupabaseClient();
        const { data } = await supabase.auth.getSession();

        const needLogin = ["write.html", "random.html", "mypage.html"];

        if (needLogin.includes(target) && !data.session?.user) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.");
            return location.href = "login.html";
        }

        location.href = target;
    });
});
</script>


<!-- ê²€ìƒ‰ ê¸°ëŠ¥ -->
<script src="./js/search.js"></script>

</body>
</html>