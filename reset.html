<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 재설정 - GALLA</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="./css/nav.css">
</head>

<body data-page="mypage">

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="assets/icons/back.svg" class="back-icon" onclick="history.back()">
            <div class="header-title">비밀번호 재설정</div>
            <div class="header-spacer"></div>
        </div>
    </header>

    <!-- GUIDE -->
    <div class="reset-guide">
        가입된 이메일을 입력하면<br>
        비밀번호 재설정 링크를 보내드립니다.
    </div>

    <!-- FORM SECTION -->
    <section class="section">
        <div class="input-group">
            <div class="input-label">아이디 (이메일)</div>
            <input type="email" class="input-field" placeholder="example@galla.com" id="resetEmail">
        </div>

        <button class="reset-btn" id="resetBtn">재설정 링크 보내기</button>

        <div class="login-link">
            돌아가기 <span onclick="location.href='login.html'">로그인</span>
        </div>
    </section>

    <nav class="nav">
      <div class="nav-inner">

        <button class="nav-item" data-page="index" data-target="index.html">
          <img src="./assets/icons/nav-home.svg"
               data-base="./assets/icons/nav-home.svg"
               data-active="./assets/icons/nav-home-active.svg">
        </button>

        <button class="nav-item" data-page="search" data-target="search.html">
          <img src="./assets/icons/nav-search.svg"
               data-base="./assets/icons/nav-search.svg"
               data-active="./assets/icons/nav-search-active.svg">
        </button>

        <button class="nav-item" data-page="write" data-target="write.html">
          <img src="./assets/icons/nav-write.svg"
               data-base="./assets/icons/nav-write.svg"
               data-active="./assets/icons/nav-write-active.svg">
        </button>

        <button class="nav-item" data-page="plaza" data-target="plaza.html">
          <img src="./assets/icons/nav-plaza.svg"
               data-base="./assets/icons/nav-plaza.svg"
               data-active="./assets/icons/nav-plaza-active.svg">
        </button>

        <button class="nav-item" data-page="mypage" data-target="mypage.html">
          <img src="./assets/icons/nav-user.svg"
               data-base="./assets/icons/nav-user.svg"
               data-active="./assets/icons/nav-user-active.svg">
        </button>

      </div>
    </nav>

    <script src="./js/nav.js"></script>

</div>

<!-- Supabase -->
<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>

<!-- ⭐ Supabase 로딩 대기 함수 -->
<script>
function waitForSupabaseClient() {
    return new Promise(resolve => {
        const timer = setInterval(() => {
            if (window.supabaseClient) {
                clearInterval(timer);
                resolve(window.supabaseClient);
            }
        }, 20);
    });
}
</script>


<!-- ⭐ 비밀번호 재설정 -->
<script>
document.getElementById("resetBtn").addEventListener("click", async () => {

    const email = document.getElementById("resetEmail").value.trim();
    if (!email) {
        alert("이메일을 입력해주세요.");
        return;
    }

    const supabase = await waitForSupabaseClient();

    const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${location.origin}/change-password.html`
    });

    if (error) {
        alert("메일 전송 실패: " + error.message);
    } else {
        alert("비밀번호 재설정 링크가 이메일로 전송되었습니다.");
    }
});
</script>

</body>
</html>