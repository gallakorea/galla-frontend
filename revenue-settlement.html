<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ì‚° ë‚´ì—­ - GALLA</title>

    <!-- í˜ì´ì§€ ì „ìš© CSS -->
    <link rel="stylesheet" href="./css/revenue-settlement.css">
</head>

<body data-page="mypage">

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="assets/icons/back.svg" class="back-icon" onclick="history.back()">
            <div class="header-title">ì •ì‚° ë‚´ì—­</div>
            <div class="header-spacer"></div>
        </div>
    </header>

    <!-- GUIDE -->
    <div class="settle-guide">
        GALLA ìˆ˜ìµì€ ë§¤ì›” 1ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ì‚°ë©ë‹ˆë‹¤.<br>
        ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ì€ ë§¤ì›” 5ì¼ ì´í›„ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
    </div>

    <!-- SUMMARY -->
    <section class="section">
        <div class="summary-card">
            <div class="sum-row">
                <span>ì´ë²ˆ ë‹¬ ì´ ìˆ˜ìµ</span>
                <span class="num">â‚© 1,240,000</span>
            </div>
            <div class="sum-row">
                <span>ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡</span>
                <span class="num">â‚© 840,000</span>
            </div>

            <button class="withdraw-btn" onclick="location.href='withdraw.html'">
                ì¶œê¸ˆ ìš”ì²­í•˜ê¸°
            </button>
        </div>
    </section>

    <!-- DETAIL LIST -->
    <section class="section">
        <div class="section-title">ğŸ“„ ì›”ë³„ ì •ì‚° ë‚´ì—­</div>

        <div class="settle-list">

            <div class="settle-item">
                <div class="left">
                    <div class="month">2025ë…„ 12ì›”</div>
                    <div class="desc">í›„ì› ê¸ˆì•¡ + ê´‘ê³  ë³´ìƒ</div>
                </div>
                <div class="amount">â‚© 1,240,000</div>
            </div>

            <div class="settle-item">
                <div class="left">
                    <div class="month">2025ë…„ 11ì›”</div>
                    <div class="desc">í›„ì› ê¸ˆì•¡ + ê´‘ê³  ë³´ìƒ</div>
                </div>
                <div class="amount">â‚© 980,000</div>
            </div>

            <div class="settle-item">
                <div class="left">
                    <div class="month">2025ë…„ 10ì›”</div>
                    <div class="desc">í›„ì› ê¸ˆì•¡ + ê´‘ê³  ë³´ìƒ</div>
                </div>
                <div class="amount">â‚© 1,120,000</div>
            </div>

        </div>
    </section>

</div>

<!-- â­ í†µì¼ëœ bottom-nav -->
<nav class="bottom-nav">

    <button class="nav-item" data-target="index.html">
        <div class="nav-indicator"></div>
        <img src="./assets/icons/nav-home.svg">
    </button>

    <button class="nav-item" data-target="search.html">
        <div class="nav-indicator"></div>
        <img src="./assets/icons/nav-search.svg">
    </button>

    <button class="nav-item" data-target="write.html">
        <div class="nav-indicator"></div>
        <img src="./assets/icons/nav-write.svg">
    </button>

    <button class="nav-item" data-target="plaza.html">
        <div class="nav-indicator"></div>
        <img src="./assets/icons/nav-plaza.svg">
    </button>

    <button class="nav-item active" data-target="mypage.html">
        <div class="nav-indicator"></div>
        <img src="./assets/icons/nav-user.svg">
    </button>

</nav>

<!-- â­ Supabase -->
<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>

<!-- â­ Supabase ë¡œë”© ëŒ€ê¸° í•¨ìˆ˜ -->
<script>
function waitForSupabaseClient() {
    return new Promise(resolve => {
        const timer = setInterval(() => {
            if (window.supabaseClient) {
                clearInterval(timer);
                resolve(window.supabaseClient);
            }
        }, 20);
    });
}
</script>

<!-- â­ í˜ì´ì§€ ì§„ì… ë¡œê·¸ì¸ ì²´í¬ -->
<script>
(async () => {
    const supabase = await waitForSupabaseClient();
    const { data } = await supabase.auth.getSession();

    if (!data.session?.user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.");
        location.href = "login.html";
    }
})();
</script>

<!-- â­ ë„¤ë¹„ê²Œì´ì…˜ ë¡œê·¸ì¸ ì²´í¬ -->
<script>
document.querySelectorAll(".nav-item").forEach(btn => {
    btn.addEventListener("click", async () => {
        const target = btn.dataset.target;
        if (!target) return;

        const supabase = await waitForSupabaseClient();
        const { data } = await supabase.auth.getSession();

        const needLogin = ["write.html", "random.html", "mypage.html", "revenue-settlement.html"];

        if (needLogin.includes(target) && !data.session?.user) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.");
            location.href = "login.html";
            return;
        }

        location.href = target;
    });
});
</script>

</body>
</html>