<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>갈라치기 성향 분석 - GALLA</title>

    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/galla-type.css">

    <style>
        /* 페이지 하단 네비 공간 확보 */
        #app {
            padding-bottom: 120px;
        }
    </style>
</head>

<body data-page="galla-type">

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="./assets/icons/back.svg" class="back-icon" onclick="history.back()">
            <div class="header-title">나의 갈라치기 성향</div>
            <div class="header-spacer"></div>
        </div>
    </header>

    <!-- TOP SUMMARY -->
    <section class="top-section" id="typeSummary">
        <div class="type-badge" id="typeName">🔥 논리적 개척자형</div>

        <div class="ratio-box">
            <div class="ratio-item">
                <div class="ratio-label">찬성</div>
                <div class="ratio-value pro" id="proRatio">62%</div>
            </div>
            <div class="ratio-item">
                <div class="ratio-label">반대</div>
                <div class="ratio-value con" id="conRatio">38%</div>
            </div>
        </div>

        <div class="sub-desc" id="typeDesc">
            당신은 새로운 이슈에 도전하고,<br>
            논리로 상대를 설득하는 타입입니다.
        </div>
    </section>


    <!-- AXIS -->
    <section class="axis-section">
        <div class="axis-title">성향 4축 분석</div>

        <div class="axis-box">
            <div class="axis-label">토론 온도</div>
            <div class="axis-bar"><div id="axisHot" class="axis-fill hot"></div></div>
            <div class="axis-detail" id="axisHotText">🔥 뜨겁게 토론하는 편</div>
        </div>

        <div class="axis-box">
            <div class="axis-label">의견 방향성</div>
            <div class="axis-bar"><div id="axisProSide" class="axis-fill pro-side"></div></div>
            <div class="axis-detail" id="axisProSideText">찬성 의견이 다소 우세</div>
        </div>

        <div class="axis-box">
            <div class="axis-label">이슈 탐색 성향</div>
            <div class="axis-bar"><div id="axisExplore" class="axis-fill explore"></div></div>
            <div class="axis-detail" id="axisExploreText">새로운 주제에 적극적</div>
        </div>

        <div class="axis-box">
            <div class="axis-label">판단 기준</div>
            <div class="axis-bar"><div id="axisLogic" class="axis-fill logic"></div></div>
            <div class="axis-detail" id="axisLogicText">감정보다 논리를 중시</div>
        </div>
    </section>

    <!-- BEHAVIOR -->
    <section class="behavior-section">
        <div class="section-title">나의 토론 패턴</div>

        <div class="behavior-card">
            <div class="behavior-row">
                <span>댓글 평균 길이</span>
                <span class="value" id="avgCommentLen">–</span>
            </div>
            <div class="behavior-row">
                <span>참여 빈도</span>
                <span class="value" id="participationFreq">–</span>
            </div>
            <div class="behavior-row">
                <span>이슈 다양성</span>
                <span class="value" id="issueVariety">–</span>
            </div>
            <div class="behavior-row">
                <span>감정 vs 논리 비율</span>
                <span class="value" id="logicRatio">–</span>
            </div>
        </div>
    </section>

    <!-- SIMILAR TYPES -->
    <section class="similar-section">
        <div class="section-title">비슷한 유형 TOP 3</div>

        <div class="similar-card" id="similarTypes">
            <div class="similar-item">🔥 전략적 분석가형</div>
            <div class="similar-item">⚡ 직설적 공격수형</div>
            <div class="similar-item">🧊 냉철한 균형 조정형</div>
        </div>
    </section>

    <!-- SHARE -->
    <button class="share-btn" id="shareBtn">결과 이미지로 공유하기</button>

    <!-- NAVIGATION -->
    <nav class="nav">
        <div class="nav-inner">
            <img src="./assets/icons/nav-home.svg" class="nav-icon nav-item" data-target="index.html">
            <img src="./assets/icons/nav-search.svg" class="nav-icon nav-item" data-target="search.html">
            <img src="./assets/icons/nav-write.svg" class="nav-icon nav-item" data-target="write.html">
            <img src="./assets/icons/nav-plaza.svg" class="nav-icon nav-item">
            <img src="./assets/icons/nav-user.svg" class="nav-icon nav-item active" data-target="mypage.html">
        </div>
    </nav>

</div>


<script>
/* ===============================
   NAV 작동
=============================== */
document.querySelectorAll(".nav-item").forEach(icon => {
    icon.addEventListener("click", () => {
        const target = icon.dataset.target;
        if (target) location.href = target;
    });
});

/* ===============================
   Supabase 준비 확인
=============================== */
function waitSupabase() {
    return new Promise(resolve => {
        const timer = setInterval(() => {
            if (window.supabaseClient) {
                clearInterval(timer);
                resolve(window.supabaseClient);
            }
        }, 20);
    });
}

(async () => {
    const supabase = await waitSupabase();

    /* 로그인 체크 */
    const { data: sessionData } = await supabase.auth.getSession();

    if (!sessionData.session?.user) {
        alert("로그인이 필요합니다.");
        location.href = "login.html";
        return;
    }

    const user = sessionData.session.user;

    // TODO: 여기에서 실제 성향 분석 데이터 fetch 할 수 있음.
    // 아래는 동적 데이터가 들어갈 자리.

})();
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script src="js/supabase.js"></script>

</body>
</html>