<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë¤ ê°ˆë¼ ë½‘ê¸° - GALLA</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/random.css">
    <link rel="stylesheet" href="css/index.css">
</head>

<body data-page="random">
<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <img src="assets/logo.png" class="logo" onclick="location.href='index.html'">

            <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ìë™ ì „í™˜ -->
            <div class="auth-buttons" id="authButtons">
                <!-- ë¡œê·¸ì¸ ì „ -->
                <button onclick="location.href='login.html'" id="loginBtn">ë¡œê·¸ì¸</button>
                <button onclick="location.href='signup.html'" id="signupBtn">íšŒì›ê°€ì…</button>

                <!-- ë¡œê·¸ì¸ í›„ -->
                <button onclick="location.href='mypage.html'" id="mypageBtn" style="display:none;">ë§ˆì´í˜ì´ì§€</button>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="random-hero">
        <div class="tornado-icon">
            <svg width="46" height="46" viewBox="0 0 24 24" fill="none"
                stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h16M2 8h20M5 12h14M7 16h10M9 20h6"/>
            </svg>
        </div>

        <h1>ëœë¤ ê°ˆë¼ ë½‘ê¸°</h1>
        <p>ì˜¤ëŠ˜ ë‹¹ì‹ ì´ ë³´ê²Œ ë  ë…¼ìŸì€?</p>
    </section>

    <!-- SLOT -->
    <section class="slot-area">
        <div id="slot1" class="slot-box">ì •ì¹˜</div>
        <div id="slot2" class="slot-box">ì›”ê¸‰</div>
        <div id="slot3" class="slot-box">ì„¸ëŒ€</div>
    </section>

    <!-- RANDOM BUTTON -->
    <div class="random-btn-wrap">
        <button id="randomBtn" class="random-btn">ğŸ² RANDOM ë½‘ê¸°</button>
    </div>

    <!-- ì¦‰ì‹œ ëœë¤ ë²„íŠ¼ -->
    <button id="floatingRandom" class="floating-random hidden">
        â­ ì¦‰ì‹œ ëœë¤
    </button>

    <!-- ëœë¤ ê²°ê³¼ -->
    <section id="resultArea" class="result-area"></section>

    <!-- ëœë¤ í”¼ë“œ -->
    <section id="randomFeed" class="random-feed"></section>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <button class="nav-item" data-target="index.html">
            <img src="assets/icons/nav-home.svg" class="nav-icon">
            <div class="nav-indicator"></div>
        </button>

        <button class="nav-item" data-target="search.html">
            <img src="assets/icons/nav-search.svg" class="nav-icon">
            <div class="nav-indicator"></div>
        </button>

        <button class="nav-item" data-target="write.html">
            <img src="assets/icons/nav-write.svg" class="nav-icon">
            <div class="nav-indicator"></div>
        </button>

        <button class="nav-item active" data-target="random.html">
            <img src="assets/icons/nav-random.svg" class="nav-icon">
            <div class="nav-indicator"></div>
        </button>

        <button class="nav-item" data-target="mypage.html">
            <img src="assets/icons/nav-user.svg" class="nav-icon">
            <div class="nav-indicator"></div>
        </button>
    </nav>

</div>

<!-- Scripts -->
<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>
<script src="js/random.js"></script>

<!-- â­ LOGIN ìƒíƒœ UI ë°˜ì˜ -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const { data } = await supabase.auth.getSession();
    const session = data.session;

    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const mypageBtn = document.getElementById("mypageBtn");

    if (session?.user) {
        // ë¡œê·¸ì¸ ìƒíƒœ â†’ ë§ˆì´í˜ì´ì§€ í‘œì‹œ
        loginBtn.style.display = "none";
        signupBtn.style.display = "none";
        mypageBtn.style.display = "inline-block";
    } else {
        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ â†’ ë¡œê·¸ì¸/íšŒì›ê°€ì… í‘œì‹œ
        loginBtn.style.display = "inline-block";
        signupBtn.style.display = "inline-block";
        mypageBtn.style.display = "none";
    }
});
</script>

<!-- â­ RANDOM ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œê·¸ì¸ í•„ìˆ˜ -->
<script>
document.getElementById("randomBtn").addEventListener("click", async () => {
    const { data } = await supabase.auth.getSession();

    if (!data.session?.user) {
        alert("ëœë¤ ë½‘ê¸°ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        location.href = "login.html";
        return;
    }

    // ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ ì‹¤ì œ ëœë¤ ì‹¤í–‰
    runRandom();
});
</script>

<!-- â­ NAVIGATION HANDLER -->
<script>
    document.querySelectorAll(".nav-item").forEach(item => {
        item.addEventListener("click", async () => {
            const target = item.dataset.target;

            // write / random / mypage â†’ ë¡œê·¸ì¸ í•„ìˆ˜
            const needLogin = ["write.html", "random.html", "mypage.html"];

            if (needLogin.includes(target)) {
                const { data } = await supabase.auth.getSession();

                if (!data.session?.user) {
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.");
                    location.href = "login.html";
                    return;
                }
            }

            if (target) location.href = target;
        });
    });
</script>

</body>
</html>