<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALLA í€˜ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="css/quest.css">
    <link rel="stylesheet" href="./css/nav.css">
</head>

<body data-page="quest">

<div id="app">

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">

            <!-- ë’¤ë¡œê°€ê¸° -->
            <img src="assets/icons/back.svg" class="back-btn" onclick="history.back()">

            <div class="header-title">ë°ì¼ë¦¬ í€˜ìŠ¤íŠ¸</div>

            <div class="header-spacer"></div>
        </div>
    </header>

    <section class="main">

        <!-- TOTAL PROGRESS RING -->
        <div class="progress-wrapper">
            <svg class="ring" width="160" height="160">
                <circle class="ring-bg" cx="80" cy="80" r="70"/>
                <circle class="ring-progress" cx="80" cy="80" r="70"/>
            </svg>
            <div class="ring-center">
                <div id="progress-percent">0%</div>
                <div class="progress-label">ì˜¤ëŠ˜ì˜ ì„ë¬´ ë‹¬ì„±ë¥ </div>
            </div>
        </div>

        <!-- DAILY QUESTS -->
        <h2 class="section-title">ë°ì¼ë¦¬ í€˜ìŠ¤íŠ¸</h2>
        <div id="daily-list" class="daily-list"></div>

        <!-- TODAY REWARD -->
        <div class="today-reward">
            <div class="tr-header">ğŸ ì˜¤ëŠ˜ì˜ ë³´ìƒ</div>

            <div class="tr-gp-total">
                <div class="tr-label">ì˜ˆìƒ ì´ ë³´ìƒ</div>
                <div id="tr-total-gp" class="tr-total-gp">0 GP</div>
            </div>

            <div class="tr-bar-wrap">
                <div class="tr-bar-bg"></div>
                <div class="tr-bar-fill" id="tr-bar-fill"></div>
            </div>

            <div id="tr-progress-text" class="tr-progress-text">0 / 0 GP</div>

            <button id="tr-claim-btn" class="tr-btn disabled">ë³´ìƒ ë°›ê¸°</button>
        </div>

        <!-- WEEKLY QUESTS -->
        <h2 class="section-title">ì£¼ê°„ í€˜ìŠ¤íŠ¸</h2>
        <div class="weekly-scroll">
            <div id="weekly-list" class="weekly-list"></div>
        </div>

        <!-- SPECIAL EVENT -->
        <h2 class="section-title-special">ğŸ”¥ ìŠ¤í˜ì…œ ì´ë²¤íŠ¸</h2>
        <div class="special-card">
            <div class="special-bg"></div>
            <div class="special-content">
                <div class="special-title">ğŸ”¥ ì´ë²ˆ ì£¼ í•«ì´ìŠˆ ì„ë¬´</div>
                <p class="special-desc">ê°€ì¥ ëœ¨ê±°ìš´ ì´ìŠˆì—ì„œ íˆ¬í‘œ + ëŒ“ê¸€ 5íšŒ ì°¸ì—¬</p>
                <button class="special-btn">+80 GP ë³´ìƒ ë°›ê¸°</button>
            </div>
        </div>

        <!-- DAILY CHEST -->
        <div class="reward-area">
            <div class="reward-icon">ğŸ</div>
            <button id="reward-btn" class="reward-btn">ì˜¤ëŠ˜ ìƒì ì—´ê¸° â†’</button>
        </div>

    </section>

    <!-- â­ NAVIGATION -->
    <nav class="nav">
        <div class="nav-inner">

            <button class="nav-item" data-page="index" data-target="index.html">
                <img src="assets/icons/nav-home.svg"
                     data-base="assets/icons/nav-home.svg"
                     data-active="assets/icons/nav-home-active.svg">
            </button>

            <button class="nav-item" data-page="search" data-target="search.html">
                <img src="assets/icons/nav-search.svg"
                     data-base="assets/icons/nav-search.svg"
                     data-active="assets/icons/nav-search-active.svg">
            </button>

            <button class="nav-item" data-page="write" data-target="write.html">
                <img src="assets/icons/nav-write.svg"
                     data-base="assets/icons/nav-write.svg"
                     data-active="assets/icons/nav-write-active.svg">
            </button>

            <button class="nav-item" data-page="plaza" data-target="plaza.html">
                <img src="assets/icons/nav-plaza.svg"
                     data-base="assets/icons/nav-plaza.svg"
                     data-active="assets/icons/nav-plaza-active.svg">
            </button>

            <button class="nav-item" data-page="mypage" data-target="mypage.html">
                <img src="assets/icons/nav-user.svg"
                     data-base="assets/icons/nav-user.svg"
                     data-active="assets/icons/nav-user-active.svg">
            </button>

        </div>
    </nav>

</div>

<!-- Supabase -->
<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script src="js/supabase.js"></script>

<!-- Quest JS -->
<script src="js/quest.js"></script>

<!-- â­ Login Check + Load Profile -->
<script>
document.addEventListener("DOMContentLoaded", async () => {

    /* ë¡œê·¸ì¸ ì²´í¬ */
    const { data } = await supabase.auth.getSession();
    const session = data.session;

    if (!session?.user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.");
        location.href = "login.html";
        return;
    }

    const userId = session.user.id;

    /* ìœ ì € í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸° */
    const { data: profile } = await supabase
        .from("user_profiles")
        .select("*")
        .eq("user_id", userId)
        .single();

    console.log("í”„ë¡œí•„ ë¡œë“œë¨:", profile);

    /* ì´í›„ quest.jsì—ì„œ í”„ë¡œí•„ ê¸°ë°˜ìœ¼ë¡œ GP, ì§„í–‰ë„ ì—…ë°ì´íŠ¸ ê°€ëŠ¥ */
});
</script>

<script src="js/nav.js"></script>

</body>
</html>